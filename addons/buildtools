#!/bin/bash
#
# UNMM Build Tools Add-on
# Sob licença MIT
#
# Criador: João Paulo (o Jppgmx)
#

ADDON_NAME="buildtools"
ADDON_DISPLAY_NAME="Ferramentas de Build"
ADDON_VERSION="1.0.0"
ADDON_DESCRIPTION="Instala as ferramentas de build essenciais para desenvolvimento do Linux."

# Array de pacotes a serem instalados (opcional)
_BT_ADDON_PACKAGES=(
    "build-essential"
    "gcc"
    "g++"
    "make"
    "cmake"
    "git"
    "pkg-config"
    "tar"
    "wget"
    "unzip"
    "curl"
)

#
#   Parâmetros de um Add-on:
#
#   ADDON_INSTALL_ARG_DISKIMAGEPATH     - caminho do arquivo de imagem de disco
#   ADDON_INSTALL_ARG_DEVICE            - dispositivo de disco alvo
#   ADDON_INSTALL_ARG_MOUNTPOINT        - ponto de montagem do sistema de arquivos raiz
#   ADDON_INSTALL_ARG_HOSTNAME          - nome do host da instalação
#   ADDON_INSTALL_ARG_USERNAME          - nome do usuário padrão
#   ADDON_INSTALL_ARG_PASSWORD          - senha do usuário padrão
#   ADDON_INSTALL_ARG_BOOTMODE          - modo de boot (bios, uefi ou hybrid)
#   ADDON_INSTALL_ARG_SIZE              - tamanho do disco em bytes
#   ADDON_INSTALL_ARG_INSTALLED_CATALOG - catálogo instalado pela CLI
#
addon_install() {
    log_info "Instalando $ADDON_DISPLAY_NAME..."
    # Instalar pacotes se definidos

    if ! chroot_call_logged "$ADDON_INSTALL_ARG_MOUNTPOINT" $APT_GET_COMMAND update; then
        log_error "Falha ao atualizar a lista de pacotes."
        return 1
    fi

    if [ ${#_BT_ADDON_PACKAGES[@]} -gt 0 ]; then
        log_verbose "Instalando pacotes de build..."
        if ! chroot_call_logged "$ADDON_INSTALL_ARG_MOUNTPOINT" $APT_GET_COMMAND "${_BT_ADDON_PACKAGES[@]}"; then
            log_error "Falha ao instalar pacotes de build."
            return 1
        fi
    fi

    log_info "$ADDON_DISPLAY_NAME instalado com sucesso."
}